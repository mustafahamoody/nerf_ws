
services:
  ros_packages:
    build:
      context: ..           
      dockerfile: docker/dockerfile
    runtime: nvidia
   
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - ROS_DOMAIN_ID=5
      - DISPLAY=${DISPLAY} # Set the display to the host display
      - MODEL_WEIGHTS_PATH=/nerf_ws/data/my_scene_nerf # Set the model weights path

    volumes:
      - ../src:/nerf_ws/src
      - ../data:/nerf_ws/data
    
    command: >
      bash -c "
        # Update entrypoint permissions
        chmod +x /entrypoint.sh &&
        
        # Create better shell configuration
        echo 'source /entrypoint.sh' >> ~/.bashrc &&
        
        # Start background services
        source ~/.bashrc &&
        ros2 launch foxglove_bridge foxglove_bridge_launch.xml &
        
        # Keep container running
        tail -f /dev/null
      "

    network_mode: host